<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Perbandingan Peta Sebelum & Sesudah</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Inisialisasi peta
    var map = L.map('map').setView([0, 0], 2);

    // Basemap
    var satellite = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      maxZoom: 20,
      subdomains: ['mt0','mt1','mt2','mt3'],
      attribution: '&copy; Google Satellite'
    }).addTo(map);

    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });

    // Fungsi membuat popup + highlight per layer
    function onEachFeatureFactory(layerName, color) {
      return function (feature, layer) {
        // Popup info
        if (feature.properties) {
          var info = "<b>" + layerName + "</b><br>";
          if (feature.properties.No) info += "<b>Nomor:</b> " + feature.properties.No + "<br>";
          if (feature.properties.Nama) info += "<b>Nama:</b> " + feature.properties.Nama + "<br>";
          if (feature.properties.NO) info += "<b>Nomor:</b> " + feature.properties.NO + "<br>";
          if (feature.properties.NAMA) info += "<b>Nama:</b> " + feature.properties.NAMA + "<br>";
          if (info === "<b>" + layerName + "</b><br>") info += "Tidak ada informasi";
          layer.bindPopup(info);
        }

        // Event highlight
        layer.on({
          mouseover: function (e) {
            e.target.setStyle({
              weight: 4,
              color: "yellow",
              fillOpacity: 0.4
            });
            e.target.bringToFront();
          },
          mouseout: function (e) {
            e.target.setStyle({
              weight: 2,
              color: color,
              fillOpacity: 0.2
            });
          },
          click: function (e) {
            e.target.setStyle({
              weight: 4,
              color: "yellow",
              fillOpacity: 0.5
            });
          }
        });
      };
    }

    // Layer GeoJSON
    var sebelum = new L.GeoJSON.AJAX("sebelum.geojson", {
      style: { color: "red", weight: 2, fillOpacity: 0.2 },
      onEachFeature: onEachFeatureFactory("Sebelum", "red")
    });

    var sesudah = new L.GeoJSON.AJAX("sesudah.geojson", {
      style: { color: "blue", weight: 2, fillOpacity: 0.2 },
      onEachFeature: onEachFeatureFactory("Sesudah", "blue")
    });

    // Tambahkan kontrol layer
    var baseMaps = {
      "Google Satellite": satellite,
      "OpenStreetMap": osm
    };
    var overlayMaps = {
      "Sebelum": sebelum,
      "Sesudah": sesudah
    };
    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Zoom otomatis ke semua layer setelah data dimuat
    var loadedLayers = 0;
    function checkFitBounds() {
      loadedLayers++;
      if (loadedLayers === 2) {
        var bounds = L.latLngBounds();
        if (sebelum.getBounds().isValid()) bounds.extend(sebelum.getBounds());
        if (sesudah.getBounds().isValid()) bounds.extend(sesudah.getBounds());
        if (bounds.isValid()) map.fitBounds(bounds);
      }
    }

    sebelum.on('data:loaded', checkFitBounds);
    sesudah.on('data:loaded', checkFitBounds);
  </script>
</body>
</html>
